# Thunderbird Localization
The [thunderbird-l10n-source](https://github.com/thunderbird/thunderbird-l10n-source)
repository contains the source en-US locale strings for Thunderbird.
They are extracted from the active branches (Daily, Beta, Release, ESRs) by the
daily [update](https://github.com/thunderbird/thunderbird-l10n-source/actions/workflows/update.yml)
GitHub action, which pulls strings from
[comm-unified-l10n](https://github.com/thunderbird/comm-unified-l10n) and
produces pull requests with new string changes. The pull requests are then
reviewed by the Thunderbird L10n team before merging into
thunderbird-l10n-source.

[Pontoon](https://pontoon.mozilla.org/projects/thunderbird/) is configured to
source from the [thunderbird-l10n-
source](https://github.com/thunderbird/thunderbird-l10n-source) repository and
to store into the
[thunderbird-l10n](https://github.com/thunderbird/thunderbird-l10n) repository.
After being synced from thunderbird-l10n-source, strings are exposed to
translators in Pontoon. Then, after strings are translated, they are synced
to thunderbird-l10n.

Translated strings are pulled into Thunderbird builds based on the pinned
revision in mail/locales/l10n-changesets.json. For example, here is
[a commit to comm-central](https://hg-edge.mozilla.org/comm-central/rev/60de483daafa18d611551d21e2fa553e2b11b470)
that updates the revision to a commit hash from thunderbird-l10n.

# Fluent Migrations
## Running fluent migrations
The goal of fluent migrations is to move from .properties and .dtd files
to .flt files without requiring new translations from translators. Once a
fluent migration is completed, and the translations are included in an official
release, there should be no visible changes for end users.

### Developer Process
The developer end of the process for creating a fluent migration is
[documented](https://source-docs.thunderbird.net/en/latest/l10n/fluent_migrations.html)
in the Thunderbird Source Docs. You can see an
[example phabricator review](https://phabricator.services.mozilla.com/D260738)
where the main calendar context menus were migrated to fluent for en-US with an
accompanying migration recipe (the bug_*.py file). The migration recipe is used
to automate the conversion of all other locales to fluent files.

### Release Engineering Process

1. The release engineering team are required reviewers of fluent migration
patches for comm-central.

2. Prior to approving the patch, the migration recipe needs to be
[tested](https://source-docs.thunderbird.net/en/latest/l10n/testing_migrations.html).

   **Note:** The mach command that is used to test migrations will show the diff
between the file included in the patch and the output of the migration recipe
applied to the file in thunderbird-l10n-source. If the diff shows differences,
they will need to be investigated. If a fix is required in the
thunderbird-l10n-source repository, then the local copy of
thunderbird-l10n-source will need to be removed from ~/.mozbuild/tb-l10n-source
before re-running the mach command. This will pull in any new changes from
thunderbird-l10n-source.

3. After a fluent migration lands in comm-central, and you are ready to perform the
fluent migration, the next step is to disable syncing in Pontoon
[project settings](https://pontoon.mozilla.org/admin/projects/thunderbird/).
This must be done prior to merging any pull requests for thunderbird-l10n-source.
By disabling syncing, we prevent any string imports into Pontoon temporarily
while the migration is performed. If this is not done, translators will be alerted
of the changes in Pontoon, causing them to translate the strings.

4. After a fluent migration patch lands on comm-central, the next
[daily update](https://github.com/thunderbird/thunderbird-l10n-source/actions/workflows/update.yml)
of thunderbird-l10n-source will create a
[pull request](https://github.com/thunderbird/thunderbird-l10n-source/pulls)
against the thunderbird-l10n-source main branch with the string updates.
You can view the [pull
request](https://github.com/thunderbird/thunderbird-l10n-source/pull/67) for the
calendar context menus example. When reviewing the pull request on
thunderbird-l10n-source, compare the changes in the pull request against the
migration recipe to ensure everything matches up.

5. To run the migrations, follow the steps documented in the
[tb-migration-scripts](https://github.com/thunderbird/tb-migration-scripts)
repository. This repository uses
[tb-fluent-migrate](https://github.com/thunderbird/tb-fluent-migrate)
to perform the string migrations, and will generate git commits in your
local thunderbird-l10n repository with new fluent files for each affected locale.
The changes will be created in a new branch, which defaults to being named
'update-migration'.

6. Create a pull request with the changes, review, and if they look correct,
merge them into the thunderbird-l10n repository. Here's
the [PR](https://github.com/thunderbird/thunderbird-l10n/pull/15) for the
calendar context menus example.

7. After merging the pull request into thunderbird-l10n, re-enable syncing
in the Pontoon [project
settings](https://pontoon.mozilla.org/admin/projects/thunderbird/).

   **Note:** It is important to note that thunderbird-l10n is configured to both source and
store. Once the new strings have landed in thunderbird-l10n, they will be synced
to Pontoon.

8. To sync immediately go to https://pontoon.mozilla.org/sync/

9. The final step is to
`hg mv ./python/l10n/tb_fluent_migrations/bug* ./python/l10n/tb_fluent_migrations/completed/`
in comm-central. This change can be pushed directly to comm-central with the following commit
message:  
`"No bug - Archive completed Fluent migration scripts. rs=me DONTBUILD"`
